# QR決済デモアプリ

## 概要

このアプリは、QRコードを利用した簡易的な決済システムのデモアプリです。商品ごとにQRコードを生成し、スマートフォンなどでスキャンすることで決済を行う仕組みを体験できます。

## 環境構築

### 1. Node.jsのインストール

1. [Node.js公式サイト](https://nodejs.org/)にアクセスします。
2. 推奨版（LTS）をダウンロードしてインストールします。
3. インストール後、以下のコマンドでバージョンを確認してください。

   ```bash
   node -v
   npm -v
   ```

   正常にインストールされていれば、Node.jsとnpmのバージョンが表示されます。

### 2. 必要なパッケージのインストール

1. ターミナルを開き、このプロジェクトのディレクトリに移動します。

   ```bash
   cd qr-kessai-app
   ```
2. 以下のコマンドを実行して必要なパッケージをインストールします。

   ```bash
   npm install
   ```

   これにより、`node_modules`フォルダが作成され、必要な依存関係がインストールされます。

## アプリの起動

1. 以下のコマンドを実行してアプリを起動します。

   ```bash
   node server.js
   ```
2. ターミナルに以下のようなメッセージが表示されます。

   ```
   サーバーが起動しました。 http://<IPアドレス>:3000
   スマホからは、PCのIPアドレスを指定してアクセスしてください。
   ```
3. ブラウザで表示されたURL（例: `http://<IPアドレス>:3000`）にアクセスします。

## ローカルLANでの接続方法

1. サーバー起動時に表示される「Network」のIPアドレス（例: `http://192.168.1.100:3000`）を確認します。
2. 同じローカルネットワーク内のスマートフォンや他のデバイスのブラウザで、上記のIPアドレスにアクセスします。

   **注意:**

   - PCとスマートフォンが同じWi-Fiネットワークに接続されている必要があります。
   - ファイアウォールの設定でポート `3000`がブロックされていないことを確認してください。

これで、ローカルLAN内の他のデバイスからアプリにアクセスできるようになります。

## 注意事項

このアプリは、同一LAN内での接続を前提としています。以下の点に注意してください：

- サーバーを起動しているPCと、QRコードをスキャンするスマートフォンや他のデバイスが**同じWi-Fiネットワーク**に接続されている必要があります。
- ファイアウォールの設定で、サーバーが使用するポート（デフォルトでは`3000`）がブロックされていないことを確認してください。
- 外部ネットワークからのアクセスを許可する場合は、ルーターのポートフォワーディング設定やセキュリティ対策が必要です。

これらの条件を満たすことで、アプリが正常に動作します。

## QRコードの生成について

### 自動生成機能

このアプリでは、`index.html`の58行目から62行目を有効にすることで、QRコードを自動生成する機能を利用できます。

現在、この機能はOFFになっており、代わりに `public/images`フォルダに手動で作成したQRコード画像を配置して動作させています。

### QRコードの形式

QRコードを自作する場合、以下の形式でURLを作成してください：

```
http://${serverIP}:${serverPort}/purchase?itemName=${encodedItemName}&price=${price}
```

- `${serverIP}`: サーバーのIPアドレス（例: `192.168.1.100`）
- `${serverPort}`: サーバーのポート番号（通常は `3000`）
- `${encodedItemName}`: 商品名をURLエンコードした文字列
- `${price}`: 商品の価格

この形式に従ってQRコードを生成することで、アプリが正しく動作します。

### QRコードの形式（実例）

以下は、QRコードのURL形式の具体例です：

```
http://192.168.1.100:3000/purchase?itemName=おにぎり&price=150
```

- `192.168.1.100`: サーバーのIPアドレス
- `3000`: サーバーのポート番号
- `おにぎり`: 商品名
- `150`: 商品の価格

この形式に従ってQRコードを生成することで、アプリが正しく動作します。

### 自作QRコードの表示方法

自作したQRコードは、`index.html`の `<img>`タグを使用して表示します。以下のように、`src`属性にQRコード画像のパスを指定してください。

#### 例

```html
<div class="product">
  <h3>ジュース</h3>
  <p>150円</p>
  <img src="images/juice.png" alt="ジュースのQRコード">
</div>

<div class="product">
  <h3>おにぎり</h3>
  <p>180円</p>
  <img src="images/onigiri.png" alt="おにぎりのQRコード">
</div>
```

- `src="images/juice.png"`: QRコード画像のパス
- `alt="ジュースのQRコード"`: 画像が表示されない場合の代替テキスト

このように設定することで、手動で作成したQRコードを表示できます。
